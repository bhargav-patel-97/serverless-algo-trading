<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Algorithmic Trading Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="app-container">
    
    <!-- Header -->
    <header class="header">
      <h1>Algorithmic Trading Dashboard</h1>
      <div class="header-status">
        <div class="status-indicator">
          <div class="status-dot"></div>
          <span class="status-text">Connecting...</span>
        </div>
        <div class="last-update">
          Last Update: <span id="lastUpdate">Never</span>
        </div>
        <button class="btn btn-sm btn-outline-primary" onclick="refreshData()">
          üîÑ Refresh
        </button>
        <button class="btn btn-sm btn-outline-danger" id="emergencyStop">
          üõë Emergency Stop
        </button>
      </div>
    </header>

    <!-- Main Layout -->
    <div class="main-layout">
      
      <!-- Sidebar Navigation -->
      <nav class="sidebar">
        <ul class="nav-list">
          <li><a href="#" class="nav-link active" data-tab="dashboard">üìä Dashboard</a></li>
          <li><a href="#" class="nav-link" data-tab="strategies">‚öôÔ∏è Strategies</a></li>
          <li><a href="#" class="nav-link" data-tab="positions">üìà Positions</a></li>
          <li><a href="#" class="nav-link" data-tab="risk">üõ°Ô∏è Risk</a></li>
          <li><a href="#" class="nav-link" data-tab="logs">üìã Logs</a></li>
          <li><a href="#" class="nav-link" data-tab="backtest">üîç Backtest</a></li>
          <li><a href="#" class="nav-link" data-tab="manual">üéØ Manual</a></li>
        </ul>
      </nav>

      <!-- Main Content Area -->
      <main class="main-content">
        
        <!-- Loading Indicator -->
        <div class="loading-indicator">
          üîÑ Loading live data...
        </div>

        <!-- DASHBOARD TAB -->
        <div id="dashboard" class="tab-content active" style="display: block;">
          
          <!-- Portfolio Overview -->
          <section class="dashboard-section">
            <h2>Portfolio Overview</h2>
            <div class="metrics-grid">
              <div class="metric-card">
                <label>Total Value</label>
                <span id="totalValue" class="metric-value">$0</span>
              </div>
              <div class="metric-card">
                <label>Cash</label>
                <span id="cashValue" class="metric-value">$0</span>
              </div>
              <div class="metric-card">
                <label>Daily P&L</label>
                <span id="dailyPnl" class="metric-value">$0</span>
              </div>
              <div class="metric-card">
                <label>Total P&L</label>
                <span id="totalPnl" class="metric-value">$0</span>
              </div>
            </div>
          </section>

          <!-- ENHANCED Performance Metrics -->
          <section class="dashboard-section">
            <h2>Performance Metrics</h2>
            <div class="metrics-grid metrics-grid-enhanced">
              
              <!-- Existing Metrics -->
              <div class="metric-card">
                <label>Total Return</label>
                <span id="totalReturn" class="metric-value">0%</span>
              </div>
              <div class="metric-card">
                <label>Sharpe Ratio</label>
                <span id="sharpeRatio" class="metric-value">0</span>
              </div>
              <div class="metric-card">
                <label>Max Drawdown</label>
                <span id="maxDrawdown" class="metric-value">0%</span>
              </div>
              <div class="metric-card">
                <label>Win Rate</label>
                <span id="winRate" class="metric-value">0%</span>
              </div>
              
              <!-- NEW Enhanced Metrics -->
              <div class="metric-card success">
                <label>All Time Trades Won</label>
                <span id="allTimeTradesWon" class="metric-value">0</span>
              </div>
              <div class="metric-card error">
                <label>All Time Trades Lost</label>
                <span id="allTimeTradesLost" class="metric-value">0</span>
              </div>
              <div class="metric-card primary">
                <label>All Time P&L ($)</label>
                <span id="allTimePnL" class="metric-value">$0</span>
              </div>
              <div class="metric-card info">
                <label>Realized P&L ($)</label>
                <span id="realizedPnL" class="metric-value">$0</span>
              </div>
              <div class="metric-card warning">
                <label>Profit Factor</label>
                <span id="profitFactor" class="metric-value">0.00</span>
              </div>
              <div class="metric-card">
                <label>Total Trades</label>
                <span id="totalTrades" class="metric-value">0</span>
              </div>
              <div class="metric-card">
                <label>Trades/Day</label>
                <span id="tradesPerDay" class="metric-value">0.0</span>
              </div>
              <div class="metric-card">
                <label>Total Volume</label>
                <span id="totalVolume" class="metric-value">$0</span>
              </div>
            </div>
          </section>

          <!-- Current Positions -->
          <section class="dashboard-section">
            <h2>Current Positions</h2>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Symbol</th>
                    <th>Qty</th>
                    <th>Entry Price</th>
                    <th>Current Price</th>
                    <th>P&L</th>
                    <th>Market Value</th>
                  </tr>
                </thead>
                <tbody id="positionsTableBody">
                  <!-- Data populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </section>

          <!-- Portfolio Performance Chart -->
          <section class="dashboard-section">
            <h2>Portfolio Performance</h2>
            <div class="chart-container">
              <canvas id="performanceChart"></canvas>
            </div>
          </section>

          <!-- Recent Trades -->
          <section class="dashboard-section">
            <h2>Recent Trades</h2>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Time</th>
                    <th>Symbol</th>
                    <th>Action</th>
                    <th>Qty</th>
                    <th>Price</th>
                    <th>Strategy</th>
                    <th>P&L</th>
                  </tr>
                </thead>
                <tbody id="tradesTableBody">
                  <!-- Data populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </section>

        </div>

        <!-- STRATEGIES TAB -->
        <div id="strategies" class="tab-content">
          
          <!-- Strategy Configuration -->
          <section class="dashboard-section">
            <h2>Strategy Configuration</h2>
            
            <!-- Strategy Tabs -->
            <div class="strategy-tabs">
              <button class="strategy-tab active" data-strategy="momentum">Momentum</button>
              <button class="strategy-tab" data-strategy="meanReversion">Mean Reversion</button>
              <button class="strategy-tab" data-strategy="regime">Regime Detection</button>
            </div>

            <!-- Momentum Strategy -->
            <div id="momentumStrategy" class="strategy-config active">
              <h3>Momentum Strategy</h3>
              <p>Moving average crossover with trend following</p>
              
              <div class="form-group">
                <label>
                  <input type="checkbox" id="momentumEnabled"> Enable Strategy
                </label>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label>Short MA Period</label>
                  <input type="number" id="maShort" value="20" min="5" max="100">
                </div>
                <div class="form-group">
                  <label>Long MA Period</label>
                  <input type="number" id="maLong" value="50" min="20" max="200">
                </div>
                <div class="form-group">
                  <label>Position Size (%)</label>
                  <input type="number" id="momentumPositionSize" value="2" min="0.5" max="10" step="0.5">
                </div>
              </div>
            </div>

            <!-- Mean Reversion Strategy -->
            <div id="meanReversionStrategy" class="strategy-config">
              <h3>Mean Reversion Strategy</h3>
              <p>RSI-based oversold/overbought trading</p>
              
              <div class="form-group">
                <label>
                  <input type="checkbox" id="meanReversionEnabled"> Enable Strategy
                </label>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label>RSI Period</label>
                  <input type="number" id="rsiPeriod" value="14" min="5" max="30">
                </div>
                <div class="form-group">
                  <label>Oversold Threshold</label>
                  <input type="number" id="oversoldThreshold" value="30" min="10" max="40">
                </div>
                <div class="form-group">
                  <label>Overbought Threshold</label>
                  <input type="number" id="overboughtThreshold" value="70" min="60" max="90">
                </div>
              </div>
            </div>

            <!-- Regime Detection Strategy -->
            <div id="regimeStrategy" class="strategy-config">
              <h3>Regime Detection Strategy</h3>
              <p>Bull/bear market detection using SPY 200-day MA</p>
              
              <div class="form-group">
                <label>
                  <input type="checkbox" id="regimeEnabled"> Enable Strategy
                </label>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label>Lookback Period</label>
                  <input type="number" id="lookbackPeriod" value="200" min="50" max="300">
                </div>
                <div class="form-group">
                  <label>Bull Market ETF</label>
                  <select id="bullEtf">
                    <option value="TQQQ">TQQQ</option>
                    <option value="UPRO">UPRO</option>
                    <option value="TECL">TECL</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Bear Market ETF</label>
                  <select id="bearEtf">
                    <option value="SQQQ">SQQQ</option>
                    <option value="SPXU">SPXU</option>
                    <option value="TECS">TECS</option>
                  </select>
                </div>
              </div>
            </div>

            <button class="btn btn-primary" id="saveStrategies">Save Configuration</button>
          </section>

          <!-- ETF Universe -->
          <section class="dashboard-section">
            <h2>ETF Universe</h2>
            <div id="etfGrid" class="etf-grid">
              <!-- Populated by JavaScript -->
            </div>
          </section>

        </div>

        <!-- ENHANCED POSITIONS TAB -->
        <div id="positions" class="tab-content">
          
          <!-- Position Management (Current Positions) -->
          <section class="dashboard-section">
            <h2>Current Position Management</h2>
            <div id="positionsDetailed" class="positions-detailed">
              <!-- Populated by JavaScript -->
            </div>
          </section>

          <!-- NEW: Position History Section -->
          <section class="dashboard-section">
            <h2>Position History</h2>
            
            <!-- History Filters -->
            <div class="history-filters">
              <div class="form-row">
                <div class="form-group">
                  <label>Status Filter</label>
                  <select id="historyStatusFilter" class="history-filter">
                    <option value="all">All Orders</option>
                    <option value="filled" selected>Filled Only</option>
                    <option value="canceled">Canceled</option>
                    <option value="pending_new">Pending</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Limit</label>
                  <select id="historyLimitFilter" class="history-filter">
                    <option value="25">25 Records</option>
                    <option value="50" selected>50 Records</option>
                    <option value="100">100 Records</option>
                    <option value="200">200 Records</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Symbol Filter</label>
                  <input type="text" id="historySymbolFilter" class="history-filter" placeholder="e.g., TQQQ,SQQQ">
                </div>
                <div class="form-group">
                  <button class="btn btn-primary" onclick="loadPositionHistory()">Apply Filters</button>
                </div>
              </div>
            </div>

            <!-- History Summary -->
            <div class="history-summary">
              <div class="metrics-grid">
                <div class="metric-card">
                  <label>Total Orders</label>
                  <span id="totalOrdersCount" class="metric-value">0</span>
                </div>
                <div class="metric-card">
                  <label>Filled Orders</label>
                  <span id="filledOrdersCount" class="metric-value">0</span>
                </div>
                <div class="metric-card">
                  <label>Total Volume</label>
                  <span id="totalVolumeAmount" class="metric-value">$0</span>
                </div>
                <div class="metric-card">
                  <label>Win Rate</label>
                  <span id="winRatePercentage" class="metric-value">0%</span>
                </div>
              </div>
            </div>

            <!-- History Table -->
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Symbol</th>
                    <th>Action</th>
                    <th>Filled Qty</th>
                    <th>Avg. Fill Price</th>
                    <th>Total Amount</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody id="positionHistoryTableBody">
                  <!-- Data populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </section>

        </div>

        <!-- RISK TAB -->
        <div id="risk" class="tab-content">
          
          <!-- Risk Parameters -->
          <section class="dashboard-section">
            <h2>Risk Parameters</h2>
            <div class="form-row">
              <div class="form-group">
                <label>Max Daily Loss (%)</label>
                <input type="number" id="maxDailyLoss" value="5" min="1" max="20" step="0.5">
              </div>
              <div class="form-group">
                <label>Max Position Size (%)</label>
                <input type="number" id="maxPositionSize" value="10" min="1" max="25" step="0.5">
              </div>
              <div class="form-group">
                <label>Stop Loss (%)</label>
                <input type="number" id="stopLoss" value="3" min="1" max="10" step="0.25">
              </div>
              <div class="form-group">
                <label>Take Profit (%)</label>
                <input type="number" id="takeProfit" value="6" min="1" max="20" step="0.25">
              </div>
            </div>
            <button class="btn btn-primary" id="saveRisk">Update Risk Settings</button>
          </section>

          <!-- Risk Metrics -->
          <section class="dashboard-section">
            <h2>Risk Metrics</h2>
            <div class="metrics-grid">
              <div class="metric-card">
                <label>Current Exposure</label>
                <span class="metric-value">0%</span>
              </div>
              <div class="metric-card">
                <label>Daily Loss Limit</label>
                <span class="metric-value">$0</span>
              </div>
              <div class="metric-card">
                <label>Available Buying Power</label>
                <span class="metric-value">$0</span>
              </div>
              <div class="metric-card">
                <label>Risk Score</label>
                <span class="metric-value">Low</span>
              </div>
            </div>
          </section>

        </div>

        <!-- LOGS TAB -->
        <div id="logs" class="tab-content">
          
          <!-- System Logs -->
          <section class="dashboard-section">
            <h2>System Logs</h2>
            
            <div class="logs-controls">
              <div class="form-row">
                <div class="form-group">
                  <select id="logLevel">
                    <option value="all">All Levels</option>
                    <option value="info">Info</option>
                    <option value="warning">Warning</option>
                    <option value="error">Error</option>
                    <option value="success">Success</option>
                  </select>
                </div>
                <div class="form-group">
                  <button class="btn btn-secondary" id="clearLogs">Clear Logs</button>
                </div>
                <div class="form-group">
                  Auto-refresh: <strong>ON</strong>
                </div>
              </div>
            </div>

            <div id="logViewer" class="log-viewer">
              <div class="log-entry">
                <span class="log-timestamp">--:--</span>
                <span class="log-level">INFO</span>
                <span class="log-message">Waiting for live data...</span>
                <span class="log-strategy">System</span>
              </div>
            </div>
          </section>

        </div>

        <!-- BACKTEST TAB -->
        <div id="backtest" class="tab-content">
          
          <!-- Backtesting -->
          <section class="dashboard-section">
            <h2>Backtesting</h2>
            
            <div class="form-row">
              <div class="form-group">
                <label>Start Date</label>
                <input type="date" id="backtestStart" value="2024-01-01">
              </div>
              <div class="form-group">
                <label>End Date</label>
                <input type="date" id="backtestEnd" value="2024-12-31">
              </div>
              <div class="form-group">
                <label>Initial Capital</label>
                <input type="number" id="initialCapital" value="100000" min="10000" max="1000000" step="10000">
              </div>
              <div class="form-group">
                <button class="btn btn-primary" id="runBacktest">Run Backtest</button>
              </div>
            </div>

            <div class="chart-container">
              <canvas id="backtestChart"></canvas>
            </div>
          </section>

        </div>

        <!-- MANUAL TAB -->
        <div id="manual" class="tab-content">
          
          <!-- Manual Trading -->
          <section class="dashboard-section">
            <h2>Manual Trading</h2>
            
            <div class="manual-trading-form">
              <div class="form-row">
                <div class="form-group">
                  <label>Symbol</label>
                  <select id="manualSymbol">
                    <option value="TQQQ">TQQQ - 3x Nasdaq Bull</option>
                    <option value="SQQQ">SQQQ - 3x Nasdaq Bear</option>
                    <option value="UPRO">UPRO - 3x S&P Bull</option>
                    <option value="SPXU">SPXU - 3x S&P Bear</option>
                    <option value="TECL">TECL - 3x Tech Bull</option>
                    <option value="TECS">TECS - 3x Tech Bear</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Quantity</label>
                  <input type="number" id="manualQuantity" value="10" min="1" max="1000">
                </div>
                <div class="form-group">
                  <label>Order Type</label>
                  <select id="orderType">
                    <option value="market">Market Order</option>
                    <option value="limit">Limit Order</option>
                  </select>
                </div>
                <div class="form-group" id="limitPriceGroup" style="display: none;">
                  <label>Limit Price ($)</label>
                  <input type="number" id="limitPrice" step="0.01">
                </div>
              </div>

              <div class="manual-trading-buttons">
                <button class="btn btn-success" id="manualBuy">Buy</button>
                <button class="btn btn-danger" id="manualSell">Sell</button>
              </div>
            </div>

            <div class="manual-trading-warning">
              <strong>‚ö†Ô∏è Risk Warning:</strong> Manual trades are subject to all risk management rules. Ensure market is open before placing orders.
            </div>
          </section>

          <!-- Quick Actions -->
          <section class="dashboard-section">
            <h2>Quick Actions</h2>
            <div class="quick-actions">
              <button class="btn btn-outline-primary">Close All Positions</button>
              <button class="btn btn-outline-warning">Reduce All Positions by 50%</button>
              <button class="btn btn-outline-info">Market Status Check</button>
            </div>

            <!-- Market Status -->
            <div class="market-status">
              <h3>Market Status</h3>
              <div class="status-row">
                <label>NYSE/NASDAQ:</label>
                <span>Loading...</span>
              </div>
              <div class="status-row">
                <label>Next Open:</label>
                <span>--</span>
              </div>
            </div>
          </section>

        </div>

      </main>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>